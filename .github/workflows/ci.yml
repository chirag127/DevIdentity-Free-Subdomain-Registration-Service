name: Continuous Integration & Deployment

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch: # Allows manual triggering of the workflow

jobs:
  validate-web-assets:
    name: Validate Web Assets
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use LTS Node.js
          cache: 'npm' # Cache npm dependencies for faster builds

      - name: Install Web Linting & Formatting Tools
        run: |
          npm install -g prettier html-validate stylelint stylelint-config-standard eslint

      - name: Run Prettier Check (Code Formatting)
        # Ensures all HTML, CSS, and JS files conform to a consistent style.
        # This command will fail if any files are not formatted correctly.
        run: prettier --check .

      - name: Validate HTML Structure and Best Practices
        # Checks HTML files for syntax errors, accessibility issues, and conformance to standards.
        # Requires a .htmlvalidaterc.js configuration file for custom rules.
        run: html-validate **/*.html

      - name: Lint CSS Files
        # Uses Stylelint to enforce coding conventions and prevent errors in CSS.
        # Requires a .stylelintrc.json for rules.
        run: stylelint "**/*.css"

      - name: Lint JavaScript Files
        # Uses ESLint to identify problematic patterns in JavaScript code.
        # Requires a .eslintrc.json for rules, or configure directly.
        run: eslint "**/*.js" || true # `|| true` to gracefully handle projects with no JS files yet

      - name: Install Lychee (Broken Link Checker)
        uses: rust-lang/setup-rust@v1
        with:
          toolchain: stable
      - run: cargo install lychee --features vendored-openssl # vendored-openssl for broader compatibility

      - name: Check for Broken Links
        # Scans all files in the repository for broken internal and external links.
        run: lychee --verbose --no-progress .

  deploy-static-site:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: validate-web-assets # Ensures all validations pass before deployment
    if: github.ref == 'refs/heads/main' # Only deploy on successful pushes to the 'main' branch
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./ # Assumes static site content is at the root of the repository
          # For a build-intensive project, this would be `publish_dir: ./dist` or similar.
          # Given the primary language is HTML, a direct publish from root is expected for simplicity.